<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloggit</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/newPost.css">
</head>
<body>
    <div id="app">
        <div id="topnav"></div>
        <div id="navbar"></div>
        <main id="content">
            <div id="create-container">
                <img src="../assets/profile-icon.png" alt="Profile Image" class="profile-pic">
                <h2>Create Post</h2>
                <form action="../../cosc360-proj/php/new-post.php" method="POST" id="postForm" enctype="multipart/form-data">
                    <select name="category" required>
                        <option value="">Select a Topic</option>
                        <?php
                        require_once '../../sql/db_connect.php'; 
                        $sql = $pdo->query("select topic_name from Topics");
                        while ($row = $sql->fetch()) {
                            $topic = htmlspecialchars($row['topic_name']);
                            echo "<option value=\"$topic\">$topic</option>";
                        }
                        ?>
                    </select>
                    <input type="text" id="postTitle" name="title" placeholder="Title" required>
                    <h3>Ad Photos...</h3>
                    <div class="img-upload">
                        <label class="upload-container">
                            <img src="../assets/plus-icon.png" alt="Upload Image">
                            <input type="file" name="image" accept="image/*" class="file-input">
                        </label>

                      </div>                      
                    <textarea id="postCaption" name="caption" placeholder="Caption..." required></textarea>
                    <input type="hidden" name="username" id="loggedInUser" />

                    <div class="button-cont">
                        <button type="submit" name="action" value="draft" class="save">Save Draft</button>
                        <button type="submit" name="action" value="post" class="post">Post</button>
                    </div>
                </form>
            </div>
        </main>
        <div id="footer"></div>
    </div>

    <script src="../scripts/router.js"></script>
    <script src="../scripts/new-post.js"></script>
    <script src="../scripts/auth.js" defer></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            checkUserLogin(); // redirect guests
            const loggedInUser = localStorage.getItem("loggedInUser");
            document.getElementById("loggedInUser").value = loggedInUser;
        });
    </script>

</body>
</html>